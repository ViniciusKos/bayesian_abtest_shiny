---
title: "R Notebook"
output: html_notebook
---


# 0.0 SETUP

```{r}
library(tidyverse)
library(reticulate)
```



```{python}
!pip install pandas
!pip install matplotlib
!pip install scipy
```



```{r}
sessionInfo()
```



```{python}
df = pd.read_csv("data_experiment.csv")
df1 = df.copy()
df1['group'] = df1['group'].replace( {"treatment":"test"})
for i in ['visits','clicks']:
    df1[i] = df1[i].astype(int)
df1 = df1.reset_index().rename( columns={'index':'day'} )
df1 = df1.pivot_table( index='day', columns='group', values=df1.select_dtypes(exclude='object').columns ,aggfunc='sum')
df1 = df1.swaplevel( axis=1 )
df1 = df1.reindex(sorted(df1.columns), axis=1).fillna(0)
df1.columns = ["_".join(i) for i in df1.columns]
for i in df1.columns:
    df1[f"acc_{i}"] = df1[i].cumsum()

df1.head()

```





```{r}

df1 <- data
for (i in c('visits', 'clicks')) {
  df1[[i]] <- as.integer(df1[[i]])
}

df1$day <- row.names(df1) %>% as.integer()

df1 <- pivot_wider(df1, 
                   id_cols = day, 
                   names_from = group, 
                   names_glue = "{group}_{.value}",
                   values_from = c( "clicks", "visits", "no_clicks" ) , 
                   values_fn = sum )

df1[is.na(df1)] <- 0

for (i in colnames(df1)) {
  df1[[paste0("acc_", i)]] <- cumsum(df1[[i]])
}

#df1 <- df1[,!names(df1) %in% c("acc_day")]

head(df1)


```




```{python}
from get_probs_function import get_prob_and_loss

get_prob_and_loss

print("hello")
```











```{r}


plot(df1$day, proba_b_better_a, type = "l", ylim = c(0, 1),
     xlab = "x1", ylab = "Probability",
     col = "green", main = "Probability and Expected Loss",
     sub = "Comparison between Test and Control")

lines(df1$day, expected_loss_A, col = "gray")
lines(df1$day, expected_loss_B, col = "blue")

legend("topright", legend = c("Probability Test better Control",
                              "Expected Loss Control",
                              "Expected Loss Test"),
       col = c("green", "gray", "blue"),
       lty = 1)
```





```{r}
df1 <- data
for (i in c('visit', 'click')) {
  df1[[i]] <- as.integer(df1[[i]])
}
df1 <- df1 %>% 
  mutate(day = row_number()) %>% 
  pivot_wider(names_from = 'group', values_from = names(select_if(., is.numeric)), values_fn = sum) %>% 
  rename_all(~paste0("day_", .)) %>% 
  select(sort(names(.))) %>% 
  mutate_all(~replace_na(., 0)) %>% 
  rename_all(~sub("_", "", .)) %>% 
  mutate(across(everything(), cumsum)) %>% 
  rename(
    clicks_A = control_click,
    clicks_B = treatment_click,
    visits_A = control_visit,
    visits_B = treatment_visit,
    acc_clicks_A = acc_control_click,
    acc_clicks_B = acc_treatment_click,
    acc_visits_A = acc_control_visit,
    acc_visits_B = acc_treatment_visit
  )
```

```{r}
head(df1)
```



